{% extends "base.html" %}

{% block title %}
  <title>Task manager - {{ project.name }}</title>
{% endblock %}

{% block content %}
  <h1>
    {{ project.name }}

    {% if project.author == user %}
      <a href="{% url 'task_manager:project-update' pk=project.id %}?next={% url 'task_manager:project-detail' pk=project.id %}" class="btn btn-outline-primary">Change</a>

      {% if project.author == user %}
        {% if project.is_active %}
          <a href="{% url 'task_manager:project-toggle-is-active' pk=project.id %}" class="btn btn-outline-warning">
            Deactivate project
          </a>
        {% else %}
          <a href="{% url 'task_manager:project-toggle-is-active' pk=project.id %}" class="btn btn-outline-success">
            Re-activate project
          </a>
        {% endif %}
      {% endif %}

      {% if can_be_deleted %}
        <a href="{% url 'task_manager:project-delete' pk=project.id %}?next={% url 'task_manager:project-detail' pk=project.id %}" class="btn btn-outline-danger">Delete</a>
      {% endif %}

    {% endif %}
  </h1>

  {% if project.description %}
    <p>{{ project.description }}</p>
  {% endif %}

  <h2>Author</h2>
  <p>{{ project.author }}</p>

  <h2>Participants</h2>

  {% regroup participants by position as regrouped_worker_list %}

  <ul>
    {% for position in regrouped_worker_list %}
      <li>
        {{ position.grouper }}
        <ul>
          {% for worker in position.list %}
            <li>
              {{ worker.first_name }} {{ worker.last_name }}
              {% if worker == project.author %}
               (<u>Author</u>)
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </li>
    {% endfor %}
  </ul>

  <h2>
    Tasks
    <a href="{% url 'task_manager:task-create' pk=project.id %}?next={% url 'task_manager:project-detail' pk=project.id %}" class="btn btn-outline-primary">+</a>
  </h2>

{% endblock %}
